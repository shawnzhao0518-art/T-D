<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>T&D Autocare | 专业汽车维修与保养</title>
    <meta name="description" content="T&D Autocare——专业汽车维修、保养、钣金喷漆与轮胎服务。在线预约，透明报价，品质保证。">
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./styles.css" />
    <link rel="icon" href="./logo.png" type="image/png" />
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  </head>
  <body>
    <a class="skip-link" href="#main">跳到主要内容</a>

    <header class="site-header">
      <div class="container header-inner">
        <a href="#" class="brand">
          <img src="./logo.png" alt="T&D Autocare Logo" class="brand-logo" />
          <span class="brand-name">T&D Autocare</span>
        </a>

        <button class="nav-toggle" aria-expanded="false" aria-controls="site-nav" aria-label="打开菜单">
          <span class="bar"></span><span class="bar"></span><span class="bar"></span>
        </button>

        <nav id="site-nav" class="site-nav" aria-label="主导航">
          <ul>
            <li><a href="#services" data-i18n="nav_services">服务项目</a></li>
            <li><a href="#about" data-i18n="nav_about">关于我们</a></li>
            <li><a href="#contact" data-i18n="nav_contact">联系我们</a></li>
            <li><a class="btn btn-primary" href="#booking" data-i18n="nav_booking">在线预约</a></li>
          </ul>
        </nav>

        <button id="lang-toggle" class="lang-toggle" aria-label="切换语言">EN / 中文</button>
      </div>
    </header>

    <main id="main">
      <!-- 保留原 hero, services, booking, about, contact 全部内容不变 -->
      <!-- 👇👇 以下省略你的原始主体内容，保持原样 👇👇 -->

      <section id="booking" class="section section-accent">
        <div class="container">
          <h2 class="section-title" data-i18n="booking_title">在线预约</h2>
          <form id="booking-form" class="form card" novalidate>
            <div class="form-row">
              <label>
                <span data-i18n="form_name_label">姓名</span>
                <input type="text" name="name" required placeholder="您的姓名" data-i18n-placeholder="form_name_ph" />
              </label>
              <label>
                <span data-i18n="form_phone_label">手机</span>
                <input type="tel" name="phone" required placeholder="例如 13800000000" pattern="^\\s*1\\d{10}\\s*$" data-i18n-placeholder="form_phone_ph" />
              </label>
            </div>
            <div class="form-row">
              <label>
                <span data-i18n="form_car_label">车型</span>
                <input type="text" name="car" required placeholder="品牌 / 车型 / 年款" data-i18n-placeholder="form_car_ph" />
              </label>
              <label>
                <span data-i18n="form_date_label">日期</span>
                <input type="date" name="date" required />
              </label>
            </div>
            <label>
              <span data-i18n="form_service_label">服务类型</span>
              <select name="service" required>
                <option value="" disabled selected data-i18n="form_service_opt_placeholder">请选择</option>
                <option data-i18n="form_service_opt_maint">保养服务</option>
                <option data-i18n="form_service_opt_engine">发动机/变速箱</option>
                <option data-i18n="form_service_opt_brake">刹车与底盘</option>
                <option data-i18n="form_service_opt_tire">轮胎与四轮定位</option>
                <option data-i18n="form_service_opt_ev">新能源专项</option>
              </select>
            </label>
            <label>
              <span data-i18n="form_note_label">备注</span>
              <textarea name="note" rows="3" placeholder="简单描述您的需求或故障现象" data-i18n-placeholder="form_note_ph"></textarea>
            </label>
            <div class="form-actions">
              <button class="btn btn-primary" type="submit" data-i18n="form_submit">提交预约</button>
              <p id="form-status" role="status" aria-live="polite"></p>
            </div>
          </form>
        </div>
      </section>

      <!-- 👆👆 你的原内容继续保持原样 👆👆 -->
    </main>

    <footer class="site-footer">
      <div class="container footer-inner">
        <a href="#" class="brand small">
          <img src="./logo.png" alt="T&D Autocare Logo" class="brand-logo" />
          <span class="brand-name">T&D Autocare</span>
        </a>
        <p>© <span id="year"></span> T&D Autocare | <span data-i18n="footer_tagline">诚信经营 · 专业服务</span></p>
        <ul class="footer-links">
          <li><a href="#services" data-i18n="footer_services">服务</a></li>
          <li><a href="#about" data-i18n="footer_about">关于</a></li>
          <li><a href="#contact" data-i18n="footer_contact">联系</a></li>
          <li><a href="#booking" data-i18n="footer_booking">预约</a></li>
        </ul>
      </div>
    </footer>

    <!-- ✅ 在原有结构中插入 Supabase 表单写入逻辑 -->
    <script type="module">
      const supabaseUrl = 'https://mgrorhbschtyrdrekfhb.supabase.co';
      const supabaseKey = 'sb_publishable_bbYg4Bl2F5uHC_3XqdH2RA_NOnp3wfc';
      const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

      const bookingForm = document.getElementById('booking-form');
      const statusEl = document.getElementById('form-status');
      const yearEl = document.getElementById('year');
      yearEl.textContent = new Date().getFullYear();

      bookingForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        statusEl.textContent = '提交中，请稍候...';

        const formData = new FormData(bookingForm);
        const record = {
          date: formData.get('date'),
          time: '09:30:00',
          car: formData.get('car') || '未填写',
          mileage: '',
          plate: '',
          project: formData.get('service'),
          price: null,
          contact: `${formData.get('name')} / ${formData.get('phone')}`,
          note: formData.get('note') || ''
        };

        try {
          const { error } = await supabaseClient.from('tasks').insert([record]);
          if (error) throw error;
          statusEl.textContent = '✅ 提交成功！我们会尽快与您联系。';
          bookingForm.reset();
          setTimeout(() => statusEl.textContent = '', 3000);
        } catch (err) {
          console.error(err);
          statusEl.textContent = '❌ 提交失败，请稍后重试。';
        }
      });
    </script>
  </body>
</html>
